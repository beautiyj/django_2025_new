{% extends 'blog/base.html' %}
{% load static %}
{% block main-area %}
    <!-- Post content-->
    <article>
        <!-- Post header-->
        <header class="mb-4">
            <!-- Post title-->
            <h1 class="fw-bolder mb-1"> {{ post.title }}</h1>
            <!-- Post meta content-->
            <div class="text-muted fst-italic mb-2">Posted on {{ post.created_date}} by {{ post.author }}</div>
            <!-- Post categories-->
            <!-- 카테고리는 있기도 하고, 없기도 한다. -->
            {%  if post.category %}
                <a class="badge bg-secondary text-decoration-none link-light" href="#!">
                    {{ post.category.name }}
                </a>
            {% else %}
                <a class="badge bg-secondary text-decoration-none link-light" href="#!">
                   미분류
                </a>
            {% endif %}
            <a class="btn btn-primary " href="/blog/{{ post.pk }}/delete/">글지우기
            </a>
            <a class="btn btn-success " href="/blog/{{ post.pk }}/update/">글수정하기
            </a>


        </header>
        <!-- Preview image figure-->
        <figure class="mb-4">
            {% if post.uploaded_image %}
                <img class="img-fluid rounded"
                 src={{ post.uploaded_image.url }} alt="..." />
            {% else %}
                <img class="img-fluid rounded"
                 src="{% static 'blog/sow.jpg' %}" alt="..." />
            {% endif %}
        </figure>
        <!-- Post content-->
        <section class="mb-5">
             <p class="fs-5 mb-4"> {{ post.content}}</p>
        </section>
        {% if post.uploaded_file %}
            <a href={{ post.uploaded_file.url }}><h3>Download</h3></a>
        {% endif %}
    </article>

   <!-- Comments section-->
<section class="mb-5">
    <div class="card bg-light">
        <div class="card-body">
            <!-- Comment form-->
            <form method="post" action="/blog/{{post.pk}}/createcomment/" class="mb-4">
                {% csrf_token %}
                {% if user.is_authenticated %}
                    {{ commentform }}
                <input type="submit" class="btn btn-sm btn-outline-info" >댓글 작성</input>
                {% endif %}
            </form>

            {% for comment in comments %}
                <!-- Comment with nested comments-->
                <div class="d-flex mb-4">
                    <div class="flex-shrink-0">
                        <img class="rounded-circle" src="https://dummyimage.com/50x50/ced4da/6c757d.jpg" alt="..." />
                    </div>
                    <div class="ms-3">
                        <div class="fw-bold">{{ comment.author.username }}</div>
                        <small class="text-muted">{{ comment.created_at|date:"Y-m-d H:i" }}</small>
                        <p>{{ comment.content }}</p>

                        {% if comment.author == user %}  {# 로그인한 유저가 댓글 작성자인 경우만 버튼 표시 #}
                        <a class="btn btn-sm btn-outline-success" href="/blog/{{comment.pk}}/updatecomment/{{ updatecomment.pk }}">
                            댓글 수정
                        </a>
                            <!--comment로받았기때문에 post.pk가 아니라 comment.pk로 받아와야함-->
                        <form action="/blog/{{comment.pk}}/deletecomment/{{ deletecomment.pk }}" method="post" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-sm btn-outline-danger">댓글 삭제</button>
                        </form>
                        {% endif %}

                    </div>
                </div>
            {% empty %}
                <p>아직 댓글이 없습니다.</p>
            {% endfor %}
        </div>
    </div>
</section>

{% endblock %}


{% block header %}
    <h1 class="fw-bolder">Detail Page</h1>
    <p class="lead mb-0">Detail Page</p>
{% endblock %}